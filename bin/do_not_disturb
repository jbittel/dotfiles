#!/usr/bin/env bash
#
# Get notifcation status or toggle do-not-disturb
#
set -o nounset
set -o pipefail

readonly MODE_NAME='do-not-disturb'

status() {
    makoctl mode | grep $MODE_NAME 2>&1 > /dev/null
    if [[ $? -eq 0 ]]; then
        echo ""
        echo "Notifications off"
    else
        echo ""
        echo "Notifications on"
    fi
}

toggle() {
    if [[ $(status) =~ "Notifications off" ]]; then
        makoctl mode -r $MODE_NAME 2>&1 > /dev/null
    else
        makoctl mode -a $MODE_NAME 2>&1 > /dev/null
    fi
}

update_waybar() {
    pkill -SIGRTMIN+10 waybar
}

usage() {
    echo "Usage: $0 {status|toggle}"
}

if [[ $# -ne 1 ]]; then
    usage
    exit 1
fi

case "$1" in
    status)
        status
        ;;
    toggle)
        toggle
        update_waybar
        status
        ;;
    *)
        usage
        exit 1
esac

exit 0
